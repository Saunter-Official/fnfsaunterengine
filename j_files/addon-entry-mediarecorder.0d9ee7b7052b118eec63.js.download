(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([[34],{1734:function(e,t,n){"use strict";t.a=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const a=window.URL.createObjectURL(t);n.href=a,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(a)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}},1782:function(e,t,n){(e.exports=n(10)(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopupContent {\n  padding: 1.5rem 2.25rem;\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 0.5rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\np.mediaRecorderPopupOption {\n  display: flex;\n  align-items: center;\n}\n\n.mediaRecorderPopupOption input[type="checkbox"] {\n  height: 1.5rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n/* TW: Fixes cancel button in dark mode */\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},1862:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return r}));var a=n(1734),o=n(1782);const r={"userscript.js":async e=>{let t,n,o,{addon:r,console:c,msg:i}=e,d=!1,s=!1,l=null,p=null,m=null,u=[];for(;;){const e=await r.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),b=()=>{const{backdrop:e,container:t,content:n,closeButton:a,remove:o}=r.tab.createModal(i("option-title"),{isOpen:!0,useEditorClasses:!0});t.classList.add("mediaRecorderPopup"),n.classList.add("mediaRecorderPopupContent"),n.appendChild(Object.assign(document.createElement("p"),{textContent:i("record-description"),className:"recordOptionDescription"}));const c=document.createElement("p"),d=Object.assign(document.createElement("input"),{type:"number",min:1,defaultValue:300,id:"recordOptionSecondsInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),s=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:i("record-duration")});c.appendChild(s),c.appendChild(d),n.appendChild(c);const l=document.createElement("p"),p=Object.assign(document.createElement("input"),{type:"number",min:0,defaultValue:0,id:"recordOptionDelayInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:i("start-delay")});l.appendChild(m),l.appendChild(p),n.appendChild(l);const u=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),b=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),h=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:i("record-audio"),title:i("record-audio-description")});u.appendChild(b),u.appendChild(h),n.appendChild(u);const g=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),C=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),O=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:i("record-mic")});g.appendChild(C),g.appendChild(O),n.appendChild(g);const E=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),f=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),w=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:i("record-after-flag")});E.appendChild(f),E.appendChild(w),n.appendChild(E);const v=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),k=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),x=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:i("record-until-stop")});f.addEventListener("change",()=>{(k.disabled=!f.checked)&&(x.title=i("record-until-stop-disabled",{afterFlagOption:i("record-after-flag")}))}),v.appendChild(k),v.appendChild(x),n.appendChild(v);const S=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),y=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionScreen"}),R=Object.assign(document.createElement("label"),{htmlFor:"recordOptionScreen",textContent:"Record the entire screen"});S.appendChild(y),S.appendChild(R),n.appendChild(S),y.disabled=!0,"mediaDevices"in navigator&&"function"==typeof navigator.mediaDevices.getDisplayMedia&&(y.disabled=!1);let j=null;const P=new Promise(e=>{j=e});let T=null;e.addEventListener("click",()=>T(null)),a.addEventListener("click",()=>T(null)),T=e=>{j(e),o()};const L=Object.assign(document.createElement("div"),{className:r.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),N=Object.assign(document.createElement("button"),{textContent:i("cancel")});N.addEventListener("click",()=>T(null),{once:!0}),L.appendChild(N);const A=Object.assign(document.createElement("button"),{textContent:i("start"),className:r.tab.scratchClass("prompt_ok-button")});return A.addEventListener("click",()=>T({secs:Number(d.value),delay:Number(p.value),audioEnabled:b.checked,micEnabled:C.checked,waitUntilFlag:f.checked,useStopSign:!k.disabled&&k.checked,recordWholeScreen:y.checked}),{once:!0}),L.appendChild(A),n.appendChild(L),P},h=()=>{d=!1,t.textContent=i("record"),t.title="",n=null,u=[],clearTimeout(o),o=0,m&&(r.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",m),m=null)},g=e=>{if(s)return r.tab.traps.vm.runtime.off("PROJECT_START",l),s=!1,l=null,p.abort(),p=null,void h();d&&n&&"inactive"!==n.state&&(e?h():(n.onstop=()=>{const e=new Blob(u,{type:"video/webm"});Object(a.a)("video.webm",e),h()},n.stop()))},C=async e=>{const a=Math.max(1,e.secs);u=[],d=!0;const b=r.tab.traps.vm;let h,C;if(e.micEnabled)try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(t){if("NotAllowedError"!==t.name&&"NotFoundError"!==t.name)throw t;e.micEnabled=!1}if(e.recordWholeScreen)try{C=await navigator.mediaDevices.getDisplayMedia({audio:e.audioEnabled,video:{mediaSource:"screen"}})}catch(t){c.warn("An error occurred trying to record the whole screen",t),e.recordWholeScreen=!1}if(e.waitUntilFlag){s=!0,Object.assign(t,{textContent:i("click-flag"),title:i("click-flag-description")}),p=new AbortController;try{await Promise.race([new Promise(e=>{l=()=>e(),b.runtime.once("PROJECT_START",l)}),new Promise((e,t)=>{p.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}s=!1,l=p=null;const O=new MediaStream;if(e.recordWholeScreen&&C){O.addTrack(C.getVideoTracks()[0]);try{O.addTrack(C.getAudioTracks()[0])}catch(e){c.warn("Cannot add screen recording's audio",e)}}else{const e=b.runtime.renderer.canvas.captureStream();O.addTrack(e.getVideoTracks()[0])}const E=new AudioContext,f=E.createMediaStreamDestination();if(e.audioEnabled){const e=b.runtime.audioEngine.audioContext.createMediaStreamDestination();b.runtime.audioEngine.inputNode.connect(e);E.createMediaStreamSource(e.stream).connect(f);for(const e of b.runtime._extensionAudioObjects.values())if(e.audioContext&&e.gainNode){const t=e.audioContext.createMediaStreamDestination();e.gainNode.connect(t);E.createMediaStreamSource(t.stream).connect(f)}}if(e.micEnabled){E.createMediaStreamSource(h).connect(f)}(e.audioEnabled||e.micEnabled)&&O.addTrack(f.stream.getAudioTracks()[0]),n=new MediaRecorder(O,{mimeType:"video/webm"}),n.ondataavailable=e=>{u.push(e.data)},n.onerror=e=>{c.warn("Recorder error:",e.error),g(!0)},o=setTimeout(()=>g(!1),1e3*a),e.useStopSign&&(m=()=>g(),b.runtime.once("PROJECT_STOP_ALL",m));const w=e.delay||0,v=Math.floor(w);for(let e=0;e<v;e++)t.textContent=i("starting-in",{secs:v-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{t.textContent=i("stop"),n.start(1e3)},1e3*(w-v))};t||(t=Object.assign(document.createElement("div"),{className:"sa-record "+e.className,textContent:i("record")}),t.addEventListener("click",async()=>{if(d)g();else{const e=await b();if(!e)return void c.log("Canceled");C(e)}})),e.parentElement.appendChild(t)}},"style.css":n.n(o).a}}}]);